SHELL = /bin/sh
OS := $(shell uname -s)

ifeq ($(OS),Darwin)
    CC = g++-8
    CFLAGS = -DBUILD_CUSTOMCC -std=c++11 -arch x86_64 -I../secp256k1/include -I../../depends/$(shell echo `../..//depends/config.guess`/include) -I../univalue/include -I../cryptoconditions/include -I../cryptoconditions/src -I../cryptoconditions/src/asn -I.. -I. -fPIC -Wl,-undefined -Wl,dynamic_lookup -Wno-write-strings -shared -dynamiclib
    TARGET = libcc.dylib
else
    ifeq ($(OS),Linux)
        CC = gcc
        CFLAGS = -Wno-write-strings -DBUILD_CUSTOMCC -std=c++11 -I../secp256k1/include -I../../depends/$(shell echo `../..//depends/config.guess`/include) -I../univalue/include -I../cryptoconditions/include -I../cryptoconditions/src -I../cryptoconditions/src/asn -I.. -I. -fPIC -shared
        TARGET = libcc.so
    else
        CC = x86_64-w64-mingw32-gcc-posix
        CFLAGS = -Wno-write-strings -DBUILD_CUSTOMCC -std=c++11 -I../secp256k1/include -I../../depends/x86_64-w64-mingw32/include -I../univalue/include -I../cryptoconditions/include -I../cryptoconditions/src -I../cryptoconditions/src/asn -I.. -I. -fPIC -shared
        TARGET = libcc.dll
    endif
endif

DEBUGFLAGS =-g -O0 -D _DEBUG
#RELEASEFLAGS = -O2 -D NDEBUG -combine -fwhole-program
SOURCES = cclib.cpp

all: $(TARGET)

$(TARGET): $(SOURCES)
	$(CC) $(CFLAGS) $(DEBUGFLAGS) -o $(TARGET) -c $(SOURCES)
	cp $(TARGET) ../$(TARGET)

clean:
	rm -rf $(TARGET)
